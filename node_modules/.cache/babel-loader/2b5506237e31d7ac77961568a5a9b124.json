{"ast":null,"code":"import _regeneratorRuntime from\"/home/madhav/Documents/freelancers/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/madhav/Documents/freelancers/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/madhav/Documents/freelancers/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{BigNumber,ethers}from\"ethers\";import React,{useCallback,useEffect,useState}from\"react\";import{toast}from\"react-toastify\";import{setPlots}from\"../actions\";import{setActivePlot}from\"../actions/plotsSlice\";import{Transactor}from\"../helpers\";import{useAppDispatch,useAppSelector,useContractLoader,useUserSigner}from\"../hooks\";import{Modal,Tooltip}from\"antd\";import updatePlots from\"../helpers/UpdatePlots\";import\"./../App.less\";export default function BuyPlot(_ref){var plot=_ref.plot,injectedProvider=_ref.injectedProvider;var dispatch=useAppDispatch();var DEBUG=useAppSelector(function(state){return state.debug.debug;});var userAddress=useAppSelector(function(state){return state.user.address;});var whitelistedAmount=useAppSelector(function(state){return state.user.whitelistedAmount;});var gasPrice=useAppSelector(function(state){return state.network.gasPrice;});var plots=useAppSelector(function(state){return state.plots.plots;});var userSigner=useUserSigner(injectedProvider);var contracts=useContractLoader(injectedProvider);var _useState=useState(0),_useState2=_slicedToArray(_useState,2),numOwnedPlots=_useState2[0],setNumOwnedPlots=_useState2[1];useEffect(function(){setNumOwnedPlots(plots.filter(function(plot){return plot.owner===userAddress;}).length);},[plots]);var tx=Transactor(userSigner,gasPrice);var buyPlot=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _plot$price,price;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!plot.sold&&userAddress&&(contracts===null||contracts===void 0?void 0:contracts.CityDaoParcel))){_context.next=8;break;}price=BigNumber.from(ethers.utils.parseEther((_plot$price=plot.price)!==null&&_plot$price!==void 0?_plot$price:\"0\"));_context.t0=tx&&plot;if(!_context.t0){_context.next=6;break;}_context.next=6;return tx(contracts.CityDaoParcel.buyPlot(plot.id,{value:price}));case 6:_context.next=13;break;case 8:if(!plot.sold){_context.next=12;break;}throw new Error(\"Plot is already sold\");case 12:if(!userAddress){toast.error(\"Please connect your wallet to buy this plot.\",{className:\"error\",toastId:\"no-connected-wallet\"});}case 13:updatePlots(contracts,plots,DEBUG).then(function(newPlots){dispatch(setPlots(newPlots));dispatch(setActivePlot(undefined));// reset active plot\n});return _context.abrupt(\"return\",true);case 15:case\"end\":return _context.stop();}}},_callee);})),[contracts,dispatch,plots,plot,userAddress,userSigner,tx]);var handleClick=function handleClick(){Modal.confirm({title:\"Legal disclaimer!\",content:\"By confirming, you hereby agree to the following conditions.. \\n      lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum\",okText:\"Yes\",cancelText:\"No\",okType:\"primary\",okButtonProps:{className:\"confirm\"},centered:true,onOk:buyPlot});};var getButton=function getButton(){var isWhitelisted=whitelistedAmount?whitelistedAmount>1:false;return/*#__PURE__*/React.createElement(\"button\",{onClick:handleClick,className:\"btn bg-primary w-full \".concat(!userAddress||!isWhitelisted||numOwnedPlots>=2?\"opacity-50\":\"\"),disabled:!userAddress||!isWhitelisted},\"Buy Now\");};var getTooltip=function getTooltip(button){var isWhitelisted=whitelistedAmount?whitelistedAmount>1:false;var text=\"Unable to purchase plot.\";if(!userAddress){text=\"Connect your wallet to buy this plot.\";}else if(!isWhitelisted){text=\"You do not have any whitelisted spots remaining. Check back tomorrow.\";}else{return button;}return/*#__PURE__*/React.createElement(Tooltip,{title:text},button);};return getTooltip(getButton());}","map":null,"metadata":{},"sourceType":"module"}