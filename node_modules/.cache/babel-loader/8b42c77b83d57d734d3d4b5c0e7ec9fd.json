{"ast":null,"code":"import _slicedToArray from\"/home/madhav/Documents/freelancers/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from\"react\";import mapboxgl from\"!mapbox-gl\";// eslint-disable-line import/no-webpack-loader-syntax\nimport loading from\"../assets/images/loading.gif\";import\"mapbox-gl/dist/mapbox-gl.css\";import{useAppSelector}from\"../hooks\";import{AnimatePresence,motion}from\"framer-motion\";mapboxgl.accessToken=process.env.REACT_APP_MAPBOX_TOKEN;export default function PlotMap(_ref){var parcel=_ref.parcel,plots=_ref.plots,startingCoordinates=_ref.startingCoordinates,startingZoom=_ref.startingZoom,startingPitch=_ref.startingPitch;var mapContainer=useRef(null);var map=useRef(null);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),mapLoaded=_useState2[0],setMapLoaded=_useState2[1];var highlightedPlot=useAppSelector(function(state){return state.plots.highlightedPlot;});var activePlot=useAppSelector(function(state){return state.plots.activePlot;});var communal=useAppSelector(function(state){return state.plots.communal;});// zoom to plot on selection\nuseEffect(function(){if(map.current&&activePlot){map.current.flyTo({center:activePlot.metadata.geojson.geometry.coordinates[0][0],zoom:startingZoom,pitch:startingPitch});}},[activePlot]);var addOutlineToMap=function addOutlineToMap(geojson,string_id){var color=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"#eff551\";if(map===null||map===void 0?void 0:map.current){if(!map.current.getSource(string_id)){map.current.addSource(string_id,{type:\"geojson\",data:geojson});}// add plot outline\nmap.current.addLayer({id:\"\".concat(string_id,\"_outline\"),source:string_id,type:\"line\",paint:{\"line-color\":color,\"line-width\":2}});}};var addFilledToMap=function addFilledToMap(geojson,string_id){var opacity=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.5;var color=arguments.length>3&&arguments[3]!==undefined?arguments[3]:\"#eff551\";if(map===null||map===void 0?void 0:map.current){if(!map.current.getSource(string_id)){map.current.addSource(string_id,{type:\"geojson\",data:geojson});}// add plot outline\nmap.current.addLayer({id:\"\".concat(string_id,\"_fill\"),source:string_id,type:\"fill\",paint:{\"fill-color\":color,\"fill-opacity\":opacity}});}};useEffect(function(){var _mapContainer$current;if(map.current)return;// only render map once\nmap.current=new mapboxgl.Map({container:(_mapContainer$current=mapContainer.current)!==null&&_mapContainer$current!==void 0?_mapContainer$current:\"\",// should never need the fallback\nstyle:\"mapbox://styles/gregrolwes/ckvsro22d1bj514oy7iy900av\",center:startingCoordinates,zoom:startingZoom,pitch:startingPitch});},[]);// Draw parcel outline and communal land\nuseEffect(function(){if(map===null||map===void 0?void 0:map.current){map.current.on(\"load\",function(){if(map.current&&map.current.getSource(\"parcel\"))return;// skip if already added\naddOutlineToMap(parcel.metadata.geojson,\"parcel\");communal.forEach(function(plot,idx){addFilledToMap(plot,idx.toString(),1,\"#06be7f\");});setTimeout(function(){setMapLoaded(true);},1000);});}},[map.current,plots]);// Add/remove plot highlight when highlighted plot changes\nuseEffect(function(){if((map===null||map===void 0?void 0:map.current)&&highlightedPlot&&!map.current.getLayer(\"highlighted_fill\")&&mapLoaded){addOutlineToMap(highlightedPlot.metadata.geojson,\"highlighted\",\"#fff\");addFilledToMap(highlightedPlot.metadata.geojson,\"highlighted\");}else if((map===null||map===void 0?void 0:map.current)&&map.current.getLayer(\"highlighted_fill\")&&mapLoaded){map.current.removeLayer(\"highlighted_fill\");map.current.removeLayer(\"highlighted_outline\");map.current.removeSource(\"highlighted\");}},[highlightedPlot,map.current]);return/*#__PURE__*/React.createElement(\"div\",{className:\"plot-map flex-grow flex flex-col relative\"},/*#__PURE__*/React.createElement(AnimatePresence,null,!mapLoaded&&/*#__PURE__*/React.createElement(Loading,null)),/*#__PURE__*/React.createElement(\"div\",{ref:mapContainer,className:\"absolute left-0 right-0 top-0 bottom-0 plot-map\"}));}function Loading(){return/*#__PURE__*/React.createElement(motion.div,{initial:{opacity:1},exit:{opacity:0},className:\"plot-map bg-black absolute left-0 right-0 top-0 bottom-0 z-10 flex items-center justify-center\"},/*#__PURE__*/React.createElement(\"img\",{src:loading,alt:\"loading\"}));}","map":null,"metadata":{},"sourceType":"module"}