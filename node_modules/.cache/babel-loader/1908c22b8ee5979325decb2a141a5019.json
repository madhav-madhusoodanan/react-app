{"ast":null,"code":"import _regeneratorRuntime from\"/home/madhav/Documents/freelancers/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/madhav/Documents/freelancers/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{ethers}from\"ethers\";import{toast}from\"react-toastify\";import{fetchMetadata}from\"../data\";var updatePlots=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(readContracts){var currentPlots,DEBUG,newPlots,plotIds,plotPrices,statuses,owners,ipfsHash,jsonManifestBuffer,plotsMetadata,index,_owners$index,plotId,isSold,price,owner,metadata,_currentPlots$index$m,_plotsMetadata$plots$,_plotsMetadata$plots$2,_plotsMetadata$plots$3,_plotsMetadata$plots$4,_plotsMetadata$plots$5,_plotsMetadata$plots$6,_plotsMetadata$plots$7,lng,lat,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:currentPlots=_args.length>1&&_args[1]!==undefined?_args[1]:[];DEBUG=_args.length>2&&_args[2]!==undefined?_args[2]:false;newPlots=[];if(!readContracts){_context.next=31;break;}_context.prev=4;_context.next=7;return readContracts.CityDaoParcel.getPlotIds();case 7:plotIds=_context.sent;_context.next=10;return readContracts.CityDaoParcel.getAllPrices();case 10:plotPrices=_context.sent;_context.next=13;return readContracts.CityDaoParcel.getAllSoldStatus();case 13:statuses=_context.sent;_context.next=16;return readContracts.CityDaoParcel.getOwners();case 16:owners=_context.sent;_context.next=19;return readContracts.CityDaoParcel.getPlotsMetadataUri();case 19:ipfsHash=_context.sent;_context.next=22;return fetchMetadata(ipfsHash);case 22:jsonManifestBuffer=_context.sent;plotsMetadata=JSON.parse(jsonManifestBuffer.toString());for(index=0;index<plotIds.length;index++){plotId=plotIds[index];isSold=statuses[index];price=!isSold?plotPrices[index]:undefined;owner=(_owners$index=owners[index])!==null&&_owners$index!==void 0?_owners$index:\"\";try{metadata={};if(currentPlots.includes(plotIds[index])){metadata=(_currentPlots$index$m=currentPlots[index].metadata)!==null&&_currentPlots$index$m!==void 0?_currentPlots$index$m:{};}else{// geojson uses lng, lat (rather than lat, lng)\nlng=(_plotsMetadata$plots$=(_plotsMetadata$plots$2=plotsMetadata.plots[index])===null||_plotsMetadata$plots$2===void 0?void 0:(_plotsMetadata$plots$3=_plotsMetadata$plots$2.geometry)===null||_plotsMetadata$plots$3===void 0?void 0:_plotsMetadata$plots$3.coordinates[0][0][0])!==null&&_plotsMetadata$plots$!==void 0?_plotsMetadata$plots$:null;lat=(_plotsMetadata$plots$4=(_plotsMetadata$plots$5=plotsMetadata.plots[index])===null||_plotsMetadata$plots$5===void 0?void 0:(_plotsMetadata$plots$6=_plotsMetadata$plots$5.geometry)===null||_plotsMetadata$plots$6===void 0?void 0:_plotsMetadata$plots$6.coordinates[0][0][1])!==null&&_plotsMetadata$plots$4!==void 0?_plotsMetadata$plots$4:null;metadata={geojson:(_plotsMetadata$plots$7=plotsMetadata.plots[index])!==null&&_plotsMetadata$plots$7!==void 0?_plotsMetadata$plots$7:{},coordinates:lat&&lng?\"\".concat(lat).concat(lat>=0?\"째N\":\"째S\",\", \").concat(lng).concat(lng>=0?\"째E\":\"째W\"):undefined,location:\"Clark, WY\"};}newPlots.push({id:plotId.toNumber(),parcel:0,price:price?ethers.utils.formatEther(price):undefined,sold:isSold,owner:owner,metadata:metadata});}catch(e){toast.error(\"Failed to read plot metadata. Please try again or contact CityDAO support.\",{className:\"error\",toastId:\"error-reading-metadata\"});DEBUG&&console.log(e);}}_context.next=31;break;case 27:_context.prev=27;_context.t0=_context[\"catch\"](4);toast.error(\"Failed to find CityDAO's contract. Make sure you're on the \".concat(process.env.REACT_APP_NETWORK,\" network.\"),{className:\"error\",toastId:\"contract-fail\"});DEBUG&&console.log(_context.t0);case 31:return _context.abrupt(\"return\",newPlots);case 32:case\"end\":return _context.stop();}}},_callee,null,[[4,27]]);}));return function updatePlots(_x){return _ref.apply(this,arguments);};}();export default updatePlots;","map":null,"metadata":{},"sourceType":"module"}