{"ast":null,"code":"/* eslint-disable import/no-dynamic-require */\n\n/* eslint-disable global-require */\nimport { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\n\nconst {\n  ethers\n} = require(\"ethers\");\n/*\n  ~ What it does? ~\n\n  Loads your local contracts and gives options to read values from contracts\n  or write transactions into them\n\n  ~ How can I use? ~\n\n  const readContracts = useContractLoader(localProvider) // or\n  const writeContracts = useContractLoader(userProvider)\n\n  ~ Features ~\n\n  - localProvider enables reading values from contracts\n  - userProvider enables writing transactions into contracts\n  - Example of keeping track of \"purpose\" variable by loading contracts into readContracts\n    and using ContractReader.js hook:\n    const purpose = useContractReader(readContracts,\"YourContract\", \"purpose\")\n  - Example of using setPurpose function from our contract and writing transactions by Transactor.js helper:\n    tx( writeContracts.YourContract.setPurpose(newPurpose) )\n\n  config can include:\n  - chainId - to hardcode the chainId, irrespective of the providerOrSigner chainId\n  - hardhatNetworkName - to hardcode the hardhat network of interest\n  - customAddresses: { contractName: 0xCustomAddress } to hardcode the address for a given named contract\n  - hardhatContracts: object following the hardhat deploy export format (Json with chainIds as keys, which have hardhat network names as keys, which contain arrays of contracts for each)\n  - externalContracts: object with chainIds as keys, with an array of contracts for each\n*/\n\n\nexport default function useContractLoader(providerOrSigner, config = {}) {\n  const [contracts, setContracts] = useState();\n  const DEBUG = useSelector(state => state.debug.debug);\n  useEffect(() => {\n    let active = true;\n\n    async function loadContracts() {\n      if (providerOrSigner && typeof providerOrSigner !== \"undefined\") {\n        try {\n          // we need to check to see if this providerOrSigner has a signer or not\n          let signer;\n          let provider;\n          let accounts;\n\n          if (providerOrSigner && typeof providerOrSigner.listAccounts === \"function\") {\n            accounts = await providerOrSigner.listAccounts();\n          }\n\n          if (ethers.Signer.isSigner(providerOrSigner)) {\n            signer = providerOrSigner;\n            provider = signer.provider;\n          } else if (accounts && accounts.length > 0) {\n            signer = providerOrSigner.getSigner();\n            provider = providerOrSigner;\n          } else {\n            signer = providerOrSigner;\n            provider = providerOrSigner;\n          }\n\n          const providerNetwork = await provider.getNetwork();\n\n          const _chainId = config.chainId || providerNetwork.chainId;\n\n          let contractList = {};\n          let externalContractList = {};\n\n          try {\n            contractList = config.hardhatContracts || require(\"../contracts/hardhat_contracts.json\");\n          } catch (e) {\n            DEBUG && console.log(e);\n          }\n\n          try {\n            externalContractList = config.externalContracts || require(\"../contracts/external_contracts.js\");\n          } catch (e) {\n            DEBUG && console.log(e);\n          }\n\n          let combinedContracts = {};\n\n          if (contractList[_chainId]) {\n            for (const hardhatNetwork in contractList[_chainId]) {\n              if (Object.prototype.hasOwnProperty.call(contractList[_chainId], hardhatNetwork)) {\n                if (!config.hardhatNetworkName || hardhatNetwork === config.hardhatNetworkName) {\n                  combinedContracts = { ...combinedContracts,\n                    ...contractList[_chainId][hardhatNetwork].contracts\n                  };\n                }\n              }\n            }\n          }\n\n          if (externalContractList[_chainId]) {\n            combinedContracts = { ...combinedContracts,\n              ...externalContractList[_chainId].contracts\n            };\n          }\n\n          const newContracts = Object.keys(combinedContracts).reduce((accumulator, contractName) => {\n            const _address = config.customAddresses && Object.keys(config.customAddresses).includes(contractName) ? config.customAddresses[contractName] : combinedContracts[contractName].address;\n\n            accumulator[contractName] = new ethers.Contract(_address, combinedContracts[contractName].abi, signer);\n            return accumulator;\n          }, {});\n          if (active) setContracts(newContracts);\n        } catch (e) {\n          DEBUG && console.log(\"ERROR LOADING CONTRACTS!!\", e);\n        }\n      }\n    }\n\n    loadContracts();\n    return () => {\n      active = false;\n    };\n  }, [providerOrSigner]);\n  return contracts;\n}","map":{"version":3,"sources":["/home/madhav/Documents/freelancers/app/packages/react-app/src/hooks/ContractLoader.js"],"names":["useEffect","useState","useSelector","ethers","require","useContractLoader","providerOrSigner","config","contracts","setContracts","DEBUG","state","debug","active","loadContracts","signer","provider","accounts","listAccounts","Signer","isSigner","length","getSigner","providerNetwork","getNetwork","_chainId","chainId","contractList","externalContractList","hardhatContracts","e","console","log","externalContracts","combinedContracts","hardhatNetwork","Object","prototype","hasOwnProperty","call","hardhatNetworkName","newContracts","keys","reduce","accumulator","contractName","_address","customAddresses","includes","address","Contract","abi"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-dynamic-require */\n/* eslint-disable global-require */\nimport { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\n\nconst { ethers } = require(\"ethers\");\n\n/*\n  ~ What it does? ~\n\n  Loads your local contracts and gives options to read values from contracts\n  or write transactions into them\n\n  ~ How can I use? ~\n\n  const readContracts = useContractLoader(localProvider) // or\n  const writeContracts = useContractLoader(userProvider)\n\n  ~ Features ~\n\n  - localProvider enables reading values from contracts\n  - userProvider enables writing transactions into contracts\n  - Example of keeping track of \"purpose\" variable by loading contracts into readContracts\n    and using ContractReader.js hook:\n    const purpose = useContractReader(readContracts,\"YourContract\", \"purpose\")\n  - Example of using setPurpose function from our contract and writing transactions by Transactor.js helper:\n    tx( writeContracts.YourContract.setPurpose(newPurpose) )\n\n  config can include:\n  - chainId - to hardcode the chainId, irrespective of the providerOrSigner chainId\n  - hardhatNetworkName - to hardcode the hardhat network of interest\n  - customAddresses: { contractName: 0xCustomAddress } to hardcode the address for a given named contract\n  - hardhatContracts: object following the hardhat deploy export format (Json with chainIds as keys, which have hardhat network names as keys, which contain arrays of contracts for each)\n  - externalContracts: object with chainIds as keys, with an array of contracts for each\n*/\n\nexport default function useContractLoader(providerOrSigner, config = {}) {\n  const [contracts, setContracts] = useState();\n\n  const DEBUG = useSelector(state => state.debug.debug);\n\n  useEffect(() => {\n    let active = true;\n\n    async function loadContracts() {\n      if (providerOrSigner && typeof providerOrSigner !== \"undefined\") {\n        try {\n          // we need to check to see if this providerOrSigner has a signer or not\n          let signer;\n          let provider;\n          let accounts;\n\n          if (providerOrSigner && typeof providerOrSigner.listAccounts === \"function\") {\n            accounts = await providerOrSigner.listAccounts();\n          }\n\n          if (ethers.Signer.isSigner(providerOrSigner)) {\n            signer = providerOrSigner;\n            provider = signer.provider;\n          } else if (accounts && accounts.length > 0) {\n            signer = providerOrSigner.getSigner();\n            provider = providerOrSigner;\n          } else {\n            signer = providerOrSigner;\n            provider = providerOrSigner;\n          }\n\n          const providerNetwork = await provider.getNetwork();\n\n          const _chainId = config.chainId || providerNetwork.chainId;\n\n          let contractList = {};\n          let externalContractList = {};\n          try {\n            contractList = config.hardhatContracts || require(\"../contracts/hardhat_contracts.json\");\n          } catch (e) {\n            DEBUG && console.log(e);\n          }\n          try {\n            externalContractList = config.externalContracts || require(\"../contracts/external_contracts.js\");\n          } catch (e) {\n            DEBUG && console.log(e);\n          }\n\n          let combinedContracts = {};\n\n          if (contractList[_chainId]) {\n            for (const hardhatNetwork in contractList[_chainId]) {\n              if (Object.prototype.hasOwnProperty.call(contractList[_chainId], hardhatNetwork)) {\n                if (!config.hardhatNetworkName || hardhatNetwork === config.hardhatNetworkName) {\n                  combinedContracts = {\n                    ...combinedContracts,\n                    ...contractList[_chainId][hardhatNetwork].contracts,\n                  };\n                }\n              }\n            }\n          }\n\n          if (externalContractList[_chainId]) {\n            combinedContracts = { ...combinedContracts, ...externalContractList[_chainId].contracts };\n          }\n\n          const newContracts = Object.keys(combinedContracts).reduce((accumulator, contractName) => {\n            const _address =\n              config.customAddresses && Object.keys(config.customAddresses).includes(contractName)\n                ? config.customAddresses[contractName]\n                : combinedContracts[contractName].address;\n            accumulator[contractName] = new ethers.Contract(_address, combinedContracts[contractName].abi, signer);\n            return accumulator;\n          }, {});\n          if (active) setContracts(newContracts);\n        } catch (e) {\n          DEBUG && console.log(\"ERROR LOADING CONTRACTS!!\", e);\n        }\n      }\n    }\n    loadContracts();\n\n    return () => {\n      active = false;\n    };\n  }, [providerOrSigner]);\n\n  return contracts;\n}\n"]},"metadata":{},"sourceType":"module"}