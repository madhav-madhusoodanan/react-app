{"ast":null,"code":"var _jsxFileName = \"/home/madhav/Documents/freelancers/app/packages/react-app/src/components/BuyPlot.tsx\";\nimport { BigNumber, ethers } from \"ethers\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { toast } from \"react-toastify\";\nimport { setPlots } from \"../actions\";\nimport { setActivePlot } from \"../actions/plotsSlice\";\nimport { Transactor } from \"../helpers\";\nimport { useAppDispatch, useAppSelector, useContractLoader, useUserSigner } from \"../hooks\";\nimport { Modal, Tooltip } from \"antd\";\nimport updatePlots from \"../helpers/UpdatePlots\";\nimport \"./../App.less\";\nexport default function BuyPlot({\n  plot,\n  injectedProvider\n}) {\n  const dispatch = useAppDispatch();\n  const DEBUG = useAppSelector(state => state.debug.debug);\n  const userAddress = useAppSelector(state => state.user.address);\n  const whitelistedAmount = useAppSelector(state => state.user.whitelistedAmount);\n  const gasPrice = useAppSelector(state => state.network.gasPrice);\n  const plots = useAppSelector(state => state.plots.plots);\n  const userSigner = useUserSigner(injectedProvider);\n  const contracts = useContractLoader(injectedProvider);\n  const [numOwnedPlots, setNumOwnedPlots] = useState(0);\n  useEffect(() => {\n    setNumOwnedPlots(plots.filter(plot => plot.owner === userAddress).length);\n  }, [plots]);\n  const tx = Transactor(userSigner, gasPrice);\n  const buyPlot = useCallback(async () => {\n    if (!plot.sold && userAddress && (contracts === null || contracts === void 0 ? void 0 : contracts.CityDaoParcel)) {\n      var _plot$price;\n\n      const price = BigNumber.from(ethers.utils.parseEther((_plot$price = plot.price) !== null && _plot$price !== void 0 ? _plot$price : \"0\"));\n      tx && plot && (await tx(contracts.CityDaoParcel.buyPlot(plot.id, {\n        value: price\n      })));\n    } else if (plot.sold) {\n      throw new Error(\"Plot is already sold\");\n    } else if (!userAddress) {\n      toast.error(\"Please connect your wallet to buy this plot.\", {\n        className: \"error\",\n        toastId: \"no-connected-wallet\"\n      });\n    }\n\n    updatePlots(contracts, plots, DEBUG).then(newPlots => {\n      dispatch(setPlots(newPlots));\n      dispatch(setActivePlot(undefined)); // reset active plot\n    });\n    return true;\n  }, [contracts, dispatch, plots, plot, userAddress, userSigner, tx]);\n\n  const handleClick = () => {\n    Modal.confirm({\n      title: \"Legal disclaimer!\",\n      content: `By confirming, you hereby agree to the following conditions.. \n      lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum`,\n      okText: \"Yes\",\n      cancelText: \"No\",\n      okType: \"primary\",\n      okButtonProps: {\n        className: \"confirm\"\n      },\n      centered: true,\n      onOk: buyPlot\n    });\n  };\n\n  const getButton = () => {\n    const isWhitelisted = whitelistedAmount ? whitelistedAmount > 1 : false;\n    return /*#__PURE__*/React.createElement(\"button\", {\n      onClick: handleClick,\n      className: `btn bg-primary w-full ${!userAddress || !isWhitelisted || numOwnedPlots >= 2 ? \"opacity-50\" : \"\"}`,\n      disabled: !userAddress || !isWhitelisted,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 7\n      }\n    }, \"Buy Now\");\n  };\n\n  const getTooltip = button => {\n    const isWhitelisted = whitelistedAmount ? whitelistedAmount > 1 : false;\n    let text = \"Unable to purchase plot.\";\n\n    if (!userAddress) {\n      text = \"Connect your wallet to buy this plot.\";\n    } else if (!isWhitelisted) {\n      text = \"You do not have any whitelisted spots remaining. Check back tomorrow.\";\n    } else {\n      return button;\n    }\n\n    return /*#__PURE__*/React.createElement(Tooltip, {\n      title: text,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 12\n      }\n    }, button);\n  };\n\n  return getTooltip(getButton());\n}","map":{"version":3,"sources":["/home/madhav/Documents/freelancers/app/packages/react-app/src/components/BuyPlot.tsx"],"names":["BigNumber","ethers","React","useCallback","useEffect","useState","toast","setPlots","setActivePlot","Transactor","useAppDispatch","useAppSelector","useContractLoader","useUserSigner","Modal","Tooltip","updatePlots","BuyPlot","plot","injectedProvider","dispatch","DEBUG","state","debug","userAddress","user","address","whitelistedAmount","gasPrice","network","plots","userSigner","contracts","numOwnedPlots","setNumOwnedPlots","filter","owner","length","tx","buyPlot","sold","CityDaoParcel","price","from","utils","parseEther","id","value","Error","error","className","toastId","then","newPlots","undefined","handleClick","confirm","title","content","okText","cancelText","okType","okButtonProps","centered","onOk","getButton","isWhitelisted","getTooltip","button","text"],"mappings":"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","sourcesContent":["import { BigNumber, ethers } from \"ethers\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { toast } from \"react-toastify\";\nimport { setPlots } from \"../actions\";\nimport { setActivePlot } from \"../actions/plotsSlice\";\nimport { Transactor } from \"../helpers\";\nimport { useAppDispatch, useAppSelector, useContractLoader, useUserSigner } from \"../hooks\";\nimport { Plot } from \"../models/Plot\";\nimport { Modal, Tooltip } from \"antd\";\nimport updatePlots from \"../helpers/UpdatePlots\";\nimport \"./../App.less\";\n\ninterface Props {\n  plot: Plot;\n  injectedProvider: any;\n}\n\nexport default function BuyPlot({ plot, injectedProvider }: Props) {\n  const dispatch = useAppDispatch();\n\n  const DEBUG = useAppSelector(state => state.debug.debug);\n  const userAddress = useAppSelector(state => state.user.address);\n  const whitelistedAmount = useAppSelector(state => state.user.whitelistedAmount);\n  const gasPrice = useAppSelector(state => state.network.gasPrice);\n  const plots = useAppSelector(state => state.plots.plots);\n  const userSigner = useUserSigner(injectedProvider);\n  const contracts: any = useContractLoader(injectedProvider);\n  const [numOwnedPlots, setNumOwnedPlots] = useState(0);\n\n  useEffect(() => {\n    setNumOwnedPlots(plots.filter(plot => plot.owner === userAddress).length);\n  }, [plots]);\n\n  const tx = Transactor(userSigner, gasPrice);\n  const buyPlot = useCallback(async () => {\n    if (!plot.sold && userAddress && contracts?.CityDaoParcel) {\n      const price = BigNumber.from(ethers.utils.parseEther(plot.price ?? \"0\"));\n      tx && plot && (await tx(contracts.CityDaoParcel.buyPlot(plot.id, { value: price })));\n    } else if (plot.sold) {\n      throw new Error(\"Plot is already sold\");\n    } else if (!userAddress) {\n      toast.error(\"Please connect your wallet to buy this plot.\", {\n        className: \"error\",\n        toastId: \"no-connected-wallet\",\n      });\n    }\n\n    updatePlots(contracts, plots, DEBUG).then(newPlots => {\n      dispatch(setPlots(newPlots));\n      dispatch(setActivePlot(undefined)); // reset active plot\n    });\n\n    return true;\n  }, [contracts, dispatch, plots, plot, userAddress, userSigner, tx]);\n\n  const handleClick = () => {\n    Modal.confirm({\n      title: \"Legal disclaimer!\",\n      content: `By confirming, you hereby agree to the following conditions.. \n      lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum`,\n      okText: \"Yes\",\n      cancelText: \"No\",\n      okType: \"primary\",\n      okButtonProps: {\n        className: \"confirm\",\n      },\n      centered: true,\n      onOk: buyPlot,\n    });\n  };\n\n  const getButton = () => {\n    const isWhitelisted = whitelistedAmount ? whitelistedAmount > 1 : false;\n    return (\n      <button\n        onClick={handleClick}\n        className={`btn bg-primary w-full ${!userAddress || !isWhitelisted || numOwnedPlots >= 2 ? \"opacity-50\" : \"\"}`}\n        disabled={!userAddress || !isWhitelisted}\n      >\n        Buy Now\n      </button>\n    );\n  };\n\n  const getTooltip = (button: JSX.Element) => {\n    const isWhitelisted = whitelistedAmount ? whitelistedAmount > 1 : false;\n    let text = \"Unable to purchase plot.\";\n    if (!userAddress) {\n      text = \"Connect your wallet to buy this plot.\";\n    } else if (!isWhitelisted) {\n      text = \"You do not have any whitelisted spots remaining. Check back tomorrow.\";\n    } else {\n      return button;\n    }\n    return <Tooltip title={text}>{button}</Tooltip>;\n  };\n\n  return getTooltip(getButton());\n}\n"]},"metadata":{},"sourceType":"module"}